<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="MR-Hive-Spark错题本, QIN">
    <meta name="description" content="专注于学习">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>MR-Hive-Spark错题本 | QIN</title>
    <link rel="icon" type="image/png" href="/%E8%B7%91%E6%AD%A5.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/%E8%B7%91%E6%AD%A5.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">QIN</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/%E8%B7%91%E6%AD%A5.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">QIN</div>
        <div class="logo-desc">
            
            专注于学习
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/13.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">MR-Hive-Spark错题本</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">No tag</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2021-10-17
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h2><h3 id="mapreduce-中的一些自定义类"><a href="#mapreduce-中的一些自定义类" class="headerlink" title="mapreduce 中的一些自定义类"></a>mapreduce 中的一些自定义类</h3><ul>
<li><p><strong>自定义分区</strong></p>
<blockquote>
<p>需要自己写一个自定义分区类继承Partitioner&lt;k2,v2&gt;，一般取分区个数的模</p>
</blockquote>
</li>
<li><p><strong>自定义排序</strong></p>
<blockquote>
<p>直接在Bean里面编写，要实现WritableComparable<Bean></p>
</blockquote>
</li>
<li><p><strong>自定义分组</strong></p>
<blockquote>
<p>自己编写一个自定义分组类，继承WritableComparator</p>
<p>1.调用无参构造</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderGroup</span> <span class="token keyword">extends</span> <span class="token class-name">WritableComparator</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token keyword">super</span><span class="token punctuation">(</span>OrderBean<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>2.重写分组</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//重写分组</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span>WritableComparable a<span class="token punctuation">,</span> WritableComparable b<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//强转</span>
OrderBean aBean <span class="token operator">=</span> <span class="token punctuation">(</span>OrderBean<span class="token punctuation">)</span> a<span class="token punctuation">;</span>
OrderBean bBean <span class="token operator">=</span> <span class="token punctuation">(</span>OrderBean<span class="token punctuation">)</span> b<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//按成绩编号</span>
<span class="token keyword">return</span> aBean<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>bBean<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
</blockquote>
</li>
<li><p><strong>自定义输入</strong></p>
<blockquote>
<p>首先编写一个类继承RecordReader&lt;k2,v2&gt;,重写里面的所有方法</p>
<p>然后编写一个类继承FileInputFormat&lt;k2,v2&gt; </p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFileInputFormat</span> <span class="token keyword">extends</span> <span class="token class-name">FileInputFormat</span><span class="token operator">&lt;</span>Text<span class="token punctuation">,</span> BytesWritable<span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> RecordReader<span class="token operator">&lt;</span>Text<span class="token punctuation">,</span> BytesWritable<span class="token operator">></span> <span class="token function">createRecordReader</span><span class="token punctuation">(</span>InputSplit inputSplit<span class="token punctuation">,</span> TaskAttemptContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">//new一个MyRecordReader对象</span>
  MyRecordReader recordReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyRecordReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  recordReader<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>inputSplit<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//调用MyRecorReader里面的初始化方法，把切片和上下文传到自定义的RecordReader中</span>
  <span class="token keyword">return</span> recordReader<span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>



<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs<span class="token punctuation">.</span>FSDataInputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs<span class="token punctuation">.</span>FileSystem<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs<span class="token punctuation">.</span>Path<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>BytesWritable<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOUtils<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span>InputSplit<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span>RecordReader<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span>TaskAttemptContext<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>input<span class="token punctuation">.</span>FileSplit<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRecordReader</span> <span class="token keyword">extends</span> <span class="token class-name">RecordReader</span><span class="token operator">&lt;</span>Text<span class="token punctuation">,</span> BytesWritable<span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
   Configuration configuration<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//配置信息</span>
   FileSplit split<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//切片</span>
   Text k <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   BytesWritable v <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">boolean</span> processed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   FileSystem fs <span class="token operator">=</span> null<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//对k1和v1进行封装</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span>InputSplit inputSplit<span class="token punctuation">,</span> TaskAttemptContext taskAttemptContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
       <span class="token comment" spellcheck="true">//初始化</span>
       split <span class="token operator">=</span> <span class="token punctuation">(</span>FileSplit<span class="token punctuation">)</span> inputSplit<span class="token punctuation">;</span>

       <span class="token comment" spellcheck="true">//通过上下文获取配置信息</span>
       configuration <span class="token operator">=</span> taskAttemptContext<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true">//核心业务逻辑，用于获取k1和v1</span>
   <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">nextKeyValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>processed<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
           <span class="token comment" spellcheck="true">//缓冲区</span>
           <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> split<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
           <span class="token comment" spellcheck="true">//1 获取fs对象，读取切片里文件里的信息，通过IO流封装到BytesWritable字节数组中</span>
           Path path <span class="token operator">=</span> split<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取切片路径</span>
           fs <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">getFileSystem</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//通过切片路径获取文件系统</span>
           <span class="token comment" spellcheck="true">//2 获取输入流</span>
           FSDataInputStream fis <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//拿到文件写到v1中,一次读一个文件</span>

           <span class="token comment" spellcheck="true">//3 拷贝 （输出流）</span>
           IOUtils<span class="token punctuation">.</span><span class="token function">readFully</span><span class="token punctuation">(</span>fis<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//fis里的内容写入到缓冲区，缓冲区里的内容再写入到v1中</span>
           <span class="token comment" spellcheck="true">//4 封装v</span>
           v<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token comment" spellcheck="true">//5 封装k</span>
           k<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//路径和文件名直接给k赋值</span>
           <span class="token comment" spellcheck="true">//6 关闭资源</span>
           IOUtils<span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span>

           processed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

       <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

       <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//获取键</span>
   <span class="token keyword">public</span> Text <span class="token function">getCurrentKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

       <span class="token keyword">return</span> k<span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//获取值</span>
   <span class="token keyword">public</span> BytesWritable <span class="token function">getCurrentValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

       <span class="token keyword">return</span> v<span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//获取正在处理的进程</span>
   <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">getProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//关闭资源</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
</blockquote>
</li>
<li><p><strong>自定义输出</strong></p>
</li>
</ul>
<h3 id="PathFilter过滤结尾文件"><a href="#PathFilter过滤结尾文件" class="headerlink" title="PathFilter过滤结尾文件"></a>PathFilter过滤结尾文件</h3><blockquote>
<p>定义类使用PathFilter接口</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyPathFilter</span> <span class="token keyword">implements</span> <span class="token class-name">PathFilter</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">accept</span><span class="token punctuation">(</span>Path path<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">!</span>path<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//在main方法中要写入如下内容：  是setInputPathFilter</span>
FileInputFormat<span class="token punctuation">.</span><span class="token function">setInputPathFilter</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span>MyPathFilter<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//第二种</span>
<span class="token comment" spellcheck="true">//定义一个类使用PathFilter接口</span>
<span class="token keyword">class</span> <span class="token class-name">RegexExcludePathFilter</span> <span class="token keyword">implements</span> <span class="token class-name">PathFilter</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//    规则</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> String regex<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">RegexExcludePathFilter</span><span class="token punctuation">(</span>String regex<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>regex <span class="token operator">=</span> regex<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">accept</span><span class="token punctuation">(</span>Path path<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//        只接受不符合regex结尾的文件</span>
        <span class="token keyword">return</span> <span class="token operator">!</span>path<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//main</span>
<span class="token comment" spellcheck="true">//        获取配置</span>
        Configuration conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        FileSystem fs <span class="token operator">=</span> FileSystem<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//        传入筛选路径以及筛选规则</span>
        FileStatus<span class="token punctuation">[</span><span class="token punctuation">]</span> status <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">globStatus</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">RegexExcludePathFilter</span><span class="token punctuation">(</span><span class="token string">"\S*.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Path<span class="token punctuation">[</span><span class="token punctuation">]</span> listedPaths <span class="token operator">=</span> FileUtil<span class="token punctuation">.</span><span class="token function">stat2Paths</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="切片获取文件名"><a href="#切片获取文件名" class="headerlink" title="切片获取文件名"></a>切片获取文件名</h3><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span>LongWritable key<span class="token punctuation">,</span> Text value<span class="token punctuation">,</span> Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    FileSplit fileSplit <span class="token operator">=</span> <span class="token punctuation">(</span>FileSplit<span class="token punctuation">)</span>context<span class="token punctuation">.</span><span class="token function">getInputSplit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String filename <span class="token operator">=</span> fileSplit<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FileSplit fileSplit <span class="token operator">=</span>  <span class="token punctuation">(</span>FileSplit<span class="token punctuation">)</span>context<span class="token punctuation">.</span><span class="token function">getInputSplit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="1-关于IO流方面的问题"><a href="#1-关于IO流方面的问题" class="headerlink" title="1.关于IO流方面的问题"></a>1.关于IO流方面的问题</h3><h4 id="1-1多表join时获取小表的内容（本地）"><a href="#1-1多表join时获取小表的内容（本地）" class="headerlink" title="1.1多表join时获取小表的内容（本地）"></a>1.1多表join时获取小表的内容（本地）</h4><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//获取文件路径</span>
File f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"D:\\BigData\\测试题\\11-30测试3\\dataAnalyze/cityCode.csv"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//文件输入流</span>
InputStream inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//使用字符流读取一行数据(要用转换流)</span>
BufferedReader reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
String line <span class="token operator">=</span>null<span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>line<span class="token operator">=</span>reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span>null<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="1-2-IO流的分类"><a href="#1-2-IO流的分类" class="headerlink" title="1.2 IO流的分类"></a>1.2 IO流的分类</h4><blockquote>
<p>分类：输入流，输出流，字节流，字符流</p>
<p>输入流：将&lt;存储设备&gt;中的内容读入到&lt;内存&gt;中。 </p>
<p>输出流：将&lt;内存&gt;中的内容写入到&lt;存储设备&gt;中。</p>
<p>字节流：以字节为单位，可以读写所有数据。</p>
<p>字符流：以字符为单位，只能读写文本数据。</p>
</blockquote>
<pre><code>InputStream：字节输入流
OutputStream：字节输出流
Reader：字符输入流
Writer：字符输出流
FileInputStream：文件输入流
FileOutputStream：文件输出流


</code></pre>
<h5 id="1-2-1-字节流"><a href="#1-2-1-字节流" class="headerlink" title="1.2.1 字节流"></a>1.2.1 字节流</h5><p><strong>InputStream</strong>：字节输入流常用方法</p>
<p><img src="img/image-20210316195410876.png" alt="image-20210316195410876"><strong>OutputStream</strong>：字节输出流常用方法</p>
<p><img src="img/image-20210316195421614.png" alt="image-20210316195421614"></p>
<ul>
<li><p><strong>InputStream</strong>和<strong>OutputStream</strong>都是抽象类，本身不能直接用来创建对象。</p>
<p> <img src="img/image-20210316194216107.png" alt="image-20210316194216107"></p>
</li>
<li><p><strong>InputStream</strong>是所有字节输入流的抽象基类</p>
<p><img src="img/image-20210316194554403.png" alt="image-20210316194554403"></p>
</li>
<li><p>文件字节输入流</p>
<p><strong>FileInputStream</strong>(文件字节输入流)主要用于文件的输入，通过该类创建的对象可以从文件中读数据。</p>
</li>
<li><p>文件字节输出流</p>
<p><strong>FileOutputStream</strong>(文件字节输出流)主要用与文件的输出，通过该类创建的对象可以往文件中写数据。</p>
</li>
</ul>
<h3 id="2-关于日期时间的转换和获取"><a href="#2-关于日期时间的转换和获取" class="headerlink" title="2.关于日期时间的转换和获取"></a>2.关于日期时间的转换和获取</h3><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//秒级时间戳转换为 "yyyy-MM-dd HH:mm:ss"  java中秒级时间戳要乘以1000</span>
SimpleDateFormat sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>Long<span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span><span class="token string">"1526926060980"</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//毫秒级时间戳转换为 "yyyy-MM-dd HH:mm:ss"</span>
SimpleDateFormat sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span>
sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>Long<span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span><span class="token string">"1526926060980"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//时间变为时间戳</span>
SimpleDateFormat format1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span>
String str <span class="token operator">=</span> <span class="token string">"2020-05-20 05:20:20"</span>
String timsimple <span class="token operator">=</span> format1<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token comment" spellcheck="true">//时间格式的转换</span>
    
<span class="token comment" spellcheck="true">//获取当前的时间</span>
SimpleDateFormat df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//设置日期格式</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// new Date()为获取当前系统时间</span>

<span class="token comment" spellcheck="true">/**
   * 提取一个月中的最后一天
   * 
   * @param day
   * @return
   */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> Date <span class="token function">getLastDate</span><span class="token punctuation">(</span><span class="token keyword">long</span> day<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
   Date date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">long</span> date_3_hm <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3600000</span> <span class="token operator">*</span> <span class="token number">34</span> <span class="token operator">*</span> day<span class="token punctuation">;</span>
   Date date_3_hm_date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>date_3_hm<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> date_3_hm_date<span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//美国时间的处理  Sun Dec 13 21:19:19 CST 2020</span>
SimpleDateFormat sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"EEE MMM dd HH:mm:ss zzz yyyy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SimpleDateFormat sdf2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//美国时间的处理 Sun Dec 13 21:19:19 CST 2020</span>
SimpleDateFormat format3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"EEE MMM dd HH:mm:ss zzz yyyy"</span><span class="token punctuation">,</span> Locale<span class="token punctuation">.</span>US<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//转为时间戳再转为标准日期</span>
<span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    String str1 <span class="token operator">=</span> <span class="token string">"Sun Dec 13 19:39:02 CST 2020"</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> timsimple <span class="token operator">=</span> format3<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timsimple<span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>format1<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>timsimple<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="2-1-求平均值，方差，标准差"><a href="#2-1-求平均值，方差，标准差" class="headerlink" title="2.1 求平均值，方差，标准差"></a>2.1 求平均值，方差，标准差</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//平均值为n,有m个数</span>
<span class="token comment" spellcheck="true">//方差为：Math.pow(,) 开方</span>
Double variance <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token operator">-</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">//求方差要用循环</span>
    variance <span class="token operator">=</span> variance<span class="token operator">/</span>m
<span class="token comment" spellcheck="true">//标准差：Math.sqrt() 开根号</span>
Double standar_deviation <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>variance<span class="token punctuation">)</span>
</code></pre>
<h3 id="3-关于mapreduce求topN的问题"><a href="#3-关于mapreduce求topN的问题" class="headerlink" title="3.关于mapreduce求topN的问题"></a>3.关于mapreduce求topN的问题</h3><h3 id="3-关于编程出现的细节"><a href="#3-关于编程出现的细节" class="headerlink" title="3.关于编程出现的细节"></a>3.关于编程出现的细节</h3><h4 id="3-1-查看日志文件"><a href="#3-1-查看日志文件" class="headerlink" title="3.1 查看日志文件"></a>3.1 查看日志文件</h4><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//查看日志文件</span>
BasicConfigurator<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="3-2-多个字段要判断空值和空字符串时"><a href="#3-2-多个字段要判断空值和空字符串时" class="headerlink" title="3.2 多个字段要判断空值和空字符串时"></a>3.2 多个字段要判断空值和空字符串时</h4><pre class=" language-java"><code class="language-java">String <span class="token punctuation">[</span><span class="token punctuation">]</span> arrlist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token string">"id"</span><span class="token punctuation">,</span>
    <span class="token string">"company_name"</span><span class="token punctuation">,</span>
    <span class="token string">"eduLevel_name"</span><span class="token punctuation">,</span>
    <span class="token string">"emplType"</span><span class="token punctuation">,</span>
    <span class="token string">"jobName"</span><span class="token punctuation">,</span>
    <span class="token string">"salary"</span><span class="token punctuation">,</span>
    <span class="token string">"createDate"</span><span class="token punctuation">,</span>
    <span class="token string">"endDate"</span><span class="token punctuation">,</span>
    <span class="token string">"city_code"</span><span class="token punctuation">,</span>
    <span class="token string">"companySize"</span><span class="token punctuation">,</span>
    <span class="token string">"welfare"</span><span class="token punctuation">,</span>
    <span class="token string">"responsibility"</span><span class="token punctuation">,</span>
    <span class="token string">"place"</span><span class="token punctuation">,</span>
    <span class="token string">"workingExp"</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
        
<span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arrlist<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>arrlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">||</span> jsonObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>arrlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        flag <span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="4-多表之间的join"><a href="#4-多表之间的join" class="headerlink" title="4. 多表之间的join"></a>4. 多表之间的join</h3><h4 id="4-1-两个大表之间的join"><a href="#4-1-两个大表之间的join" class="headerlink" title="4.1 两个大表之间的join"></a>4.1 两个大表之间的join</h4><blockquote>
<p>如果还有小表，那么小表要在map端进行操作，用IO流获取小表的路径</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//两个大表之间的join，要在reduce端操作</span>
<span class="token comment" spellcheck="true">//首先在map端把数据切割，一个表中没有的字段要留空值，并且标记好两张表，方便reduce端操作</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token operator">&lt;</span>LongWritable<span class="token punctuation">,</span> Text<span class="token punctuation">,</span>Text<span class="token punctuation">,</span> UserBean<span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>String<span class="token operator">></span> adMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        File f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"E:\\BigDataCompetition\\测试题\\input\\db.log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        InputStream inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>

        BufferedReader reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String line<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            String<span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            adMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span>LongWritable key<span class="token punctuation">,</span> Text value<span class="token punctuation">,</span> Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//通过上下文切片获取文件的名字</span>
        FileSplit fileSplit <span class="token operator">=</span> <span class="token punctuation">(</span>FileSplit<span class="token punctuation">)</span>context<span class="token punctuation">.</span><span class="token function">getInputSplit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String filename <span class="token operator">=</span> fileSplit<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        UserBean userBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Text text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            String<span class="token punctuation">[</span><span class="token punctuation">]</span> line <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
                text<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               userBean<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment" spellcheck="true">//System.out.println(userBean.getUserId());</span>
               userBean<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               userBean<span class="token punctuation">.</span><span class="token function">setYear</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               userBean<span class="token punctuation">.</span><span class="token function">setEduction</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               userBean<span class="token punctuation">.</span><span class="token function">setWork</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               userBean<span class="token punctuation">.</span><span class="token function">setSalary</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               userBean<span class="token punctuation">.</span><span class="token function">setAddressCode</span><span class="token punctuation">(</span>adMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               userBean<span class="token punctuation">.</span><span class="token function">setWorkAddress</span><span class="token punctuation">(</span>adMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               userBean<span class="token punctuation">.</span><span class="token function">setCityType</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment" spellcheck="true">//System.out.println(userBean.getCityType());</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankA</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankB</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankC</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankD</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankE</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankF</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankG</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankH</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//做一个标记</span>
                context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span>userBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"credit"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            String<span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>split<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

                userBean<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setYear</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setEduction</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setWork</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setSalary</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setAddressCode</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setWorkAddress</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setCityType</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                text<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankA</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankB</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankC</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankD</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankE</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankF</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankG</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setBankH</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userBean<span class="token punctuation">.</span><span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token string">"credit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span>userBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// BeanUtils.copyProperties() 把值放入Bean对象中</span>
<span class="token comment" spellcheck="true">//ruduce端进行连接，要新new两个Bean对象，把一张表的Bean放入集合中，另一张表直接放入Bean对象中，最后遍历集合，集合中没有的字段从另一个Bean对象中get</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token operator">&lt;</span>Text<span class="token punctuation">,</span>UserBean<span class="token punctuation">,</span> NullWritable<span class="token punctuation">,</span>UserBean<span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span>Text key<span class="token punctuation">,</span> Iterable<span class="token operator">&lt;</span>UserBean<span class="token operator">></span> values<span class="token punctuation">,</span> Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        ArrayList<span class="token operator">&lt;</span>UserBean<span class="token operator">></span> userBeans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>UserBean<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        UserBean bankBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span>UserBean value<span class="token operator">:</span>values<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
                UserBean usBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
                    BeanUtils<span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>usBean<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//当表为user时把数据放到usBean中</span>
                    userBeans<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>usBean<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//usBean放入到存放用信息的集合中</span>
                <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">else</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
                    BeanUtils<span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>bankBean<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>UserBean userBean<span class="token operator">:</span>userBeans<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            userBean<span class="token punctuation">.</span><span class="token function">setBankA</span><span class="token punctuation">(</span>bankBean<span class="token punctuation">.</span><span class="token function">getBankA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userBean<span class="token punctuation">.</span><span class="token function">setBankB</span><span class="token punctuation">(</span>bankBean<span class="token punctuation">.</span><span class="token function">getBankB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userBean<span class="token punctuation">.</span><span class="token function">setBankC</span><span class="token punctuation">(</span>bankBean<span class="token punctuation">.</span><span class="token function">getBankC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userBean<span class="token punctuation">.</span><span class="token function">setBankD</span><span class="token punctuation">(</span>bankBean<span class="token punctuation">.</span><span class="token function">getBankD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userBean<span class="token punctuation">.</span><span class="token function">setBankE</span><span class="token punctuation">(</span>bankBean<span class="token punctuation">.</span><span class="token function">getBankE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userBean<span class="token punctuation">.</span><span class="token function">setBankF</span><span class="token punctuation">(</span>bankBean<span class="token punctuation">.</span><span class="token function">getBankF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userBean<span class="token punctuation">.</span><span class="token function">setBankG</span><span class="token punctuation">(</span>bankBean<span class="token punctuation">.</span><span class="token function">getBankG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userBean<span class="token punctuation">.</span><span class="token function">setBankH</span><span class="token punctuation">(</span>bankBean<span class="token punctuation">.</span><span class="token function">getBankH</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>NullWritable<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>userBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="4-2-小表与大表的join-hdfs"><a href="#4-2-小表与大表的join-hdfs" class="headerlink" title="4.2 小表与大表的join(hdfs)"></a>4.2 小表与大表的join(hdfs)</h4><blockquote>
<p>在本地运行的话参考1.1</p>
</blockquote>
<pre class=" language-JAVA"><code class="language-JAVA">//在hdfs上运行要把表上传到分布式缓存中
//在main方法中
job.addCacheFile(new URI("hdfs://ky002:9000/input/db.log"))//HDFS上的路径
    //小表是mysql表时要导入jar包
job.addArchiveToClassPath(new Path(strings[2]));
//map
    HashMap<String,String> adMap = new HashMap<String, String>();
    @Override
    protected void setup(Context context) throws IOException, InterruptedException &#123;
        //将分布式缓存的小表数据读取到本地map
        //1.获取分布式缓存文件列表
        URI[] cacheFiles = context.getCacheFiles();
        //2.获取指定的分布式缓存文件的文件系统（FileSystem）
        FileSystem fileSystem = FileSystem.get(cacheFiles[0], context.getConfiguration());
        //3.获取文件的输入流
        FSDataInputStream inputStream = fileSystem.open(new Path(cacheFiles[0]));
        //4.读取文件内容，并将数据存入map集合
        //4.1将字节输入流转为字符缓冲流
        BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream));
        //4.2读取小表文件内容，以行为单位，并将读取的数据存入map集合
        String line;
        while (StringUtils.isNotEmpty(line = reader.readLine()))&#123;
            String[] split = line.split(",");
            adMap.put(split[0],split[1] );
        &#125;
        //5.关闭流
        //fileSystem.close();
        //reader.close();
</code></pre>
<h4 id="4-3-小表与大表的join（小表来自mysql）"><a href="#4-3-小表与大表的join（小表来自mysql）" class="headerlink" title="4.3 小表与大表的join（小表来自mysql）"></a>4.3 小表与大表的join（小表来自mysql）</h4><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//main方法里面</span>
strings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token string">"hdfs://ky002:9000/input/1.log"</span><span class="token punctuation">,</span>
    <span class="token string">"hdfs://ky002:9000/output/t02"</span><span class="token punctuation">,</span>
    <span class="token string">"file:///hivedata/mysql-connector-java-5.1.27.jar"</span>  <span class="token operator">/</span><span class="token operator">/</span>在集群中的jar位置
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

job<span class="token punctuation">.</span><span class="token function">addArchiveToClassPath</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>strings<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//map端</span>
<span class="token keyword">private</span> String Connection conn<span class="token operator">=</span>null<span class="token punctuation">;</span>
<span class="token keyword">private</span> String Statement stat<span class="token operator">=</span>null<span class="token punctuation">;</span>
<span class="token keyword">private</span> String ResultSet rs<span class="token operator">=</span>null<span class="token punctuation">;</span>
HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>String<span class="token operator">></span> addressMap <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://localhost:3306/jdbc"</span><span class="token punctuation">;</span>
        String userName <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
        String passWord <span class="token operator">=</span><span class="token string">"123456"</span><span class="token punctuation">;</span>
        conn<span class="token operator">=</span>DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        stat<span class="token operator">=</span>conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String sql <span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
        rs <span class="token operator">=</span> stat<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            String addressCode <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//System.out.println(rs.getString(2));</span>
            String address <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            addressMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>addressCode<span class="token punctuation">,</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">catch</span><span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="5-mapruduce读写数据"><a href="#5-mapruduce读写数据" class="headerlink" title="5.mapruduce读写数据"></a>5.mapruduce读写数据</h3><h4 id="5-1-读写mysql中的数据"><a href="#5-1-读写mysql中的数据" class="headerlink" title="5.1 读写mysql中的数据"></a>5.1 读写mysql中的数据</h4><pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> Connection conn<span class="token operator">=</span>null<span class="token punctuation">;</span>
<span class="token keyword">private</span> Statement stmt<span class="token operator">=</span>null<span class="token punctuation">;</span>
<span class="token keyword">private</span> ResultSet rs <span class="token operator">=</span> null<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//首先连接mysql</span>
Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://localhost:3306/jdbc?serverTimezone=UTC"</span><span class="token punctuation">;</span>
String username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
String password <span class="token operator">=</span> <span class="token string">"123465"</span>

<span class="token keyword">return</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>user<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//或者</span>
conn <span class="token operator">=</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>usrname<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
stmt<span class="token operator">=</span>conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//发送sql语句</span>
String sql <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
rs <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//把数据写入到msql中</span>
<span class="token comment" spellcheck="true">/*
在Bean里面，除了实现 WritableComparable&lt;WorkBean>  外还要实现DBWritable
然后重写两个方法
*/</span>
<span class="token comment" spellcheck="true">//写数据</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span>PreparedStatement preparedStatement<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>company_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>eduLevel_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>emplType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>jobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span>createDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>endDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>city_code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>companySize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>welfare<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span>responsibility<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span>place<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span>workingExp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//用来读数据</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readFields</span><span class="token punctuation">(</span>ResultSet resultSet<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>deptNo <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>deptName <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>location <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/*
main类里面
*/</span>
<span class="token comment" spellcheck="true">//配置信息</span>
 DBConfiguration<span class="token punctuation">.</span><span class="token function">configureDB</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">,</span>
                <span class="token string">"jdbc:mysql://ky002:3306/mydb?serverTimezone=UTC"</span><span class="token punctuation">,</span>
                <span class="token string">"root"</span><span class="token punctuation">,</span>
                <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//读数据</span>
job<span class="token punctuation">.</span>job<span class="token punctuation">.</span><span class="token function">setInputFormatClass</span><span class="token punctuation">(</span>DBInputFormat<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String<span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token string">"dept_no"</span><span class="token punctuation">,</span> <span class="token string">"dept_name"</span><span class="token punctuation">,</span> <span class="token string">"dept_location"</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
DBInputFormat<span class="token punctuation">.</span><span class="token function">setInput</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> DeptBean<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">"表名"</span><span class="token punctuation">,</span> <span class="token string">"where语句"</span><span class="token punctuation">,</span> <span class="token string">"order by语句"</span><span class="token punctuation">,</span> fields<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//写数据</span>
job<span class="token punctuation">.</span>job<span class="token punctuation">.</span><span class="token function">setOutputFormatClass</span><span class="token punctuation">(</span>DBInputFormat<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//选择输出的表名和字段</span>
DBOutputFormat<span class="token punctuation">.</span><span class="token function">setOutput</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token string">"advertises"</span><span class="token punctuation">,</span><span class="token string">"id"</span><span class="token punctuation">,</span>
                         <span class="token string">"company_name"</span><span class="token punctuation">,</span>
                         <span class="token string">"eduLevel_name"</span><span class="token punctuation">,</span>
                         <span class="token string">"emplType"</span><span class="token punctuation">,</span>
                         <span class="token string">"jobName"</span><span class="token punctuation">,</span>
                         <span class="token string">"salary"</span><span class="token punctuation">,</span>
                         <span class="token string">"createDate"</span><span class="token punctuation">,</span>
                         <span class="token string">"endDate"</span><span class="token punctuation">,</span>
                         <span class="token string">"city_name"</span><span class="token punctuation">,</span>
                         <span class="token string">"companySize"</span><span class="token punctuation">,</span>
                         <span class="token string">"welfare"</span><span class="token punctuation">,</span>
                         <span class="token string">"responsibility"</span><span class="token punctuation">,</span>
                         <span class="token string">"place"</span><span class="token punctuation">,</span>
                         <span class="token string">"workingExp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="5-2-读取json文件"><a href="#5-2-读取json文件" class="headerlink" title="5.2 读取json文件"></a>5.2 读取json文件</h4><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>jettison<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JSONException<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>jettison<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JSONObject<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span>LongWritable key<span class="token punctuation">,</span> Text value<span class="token punctuation">,</span> Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> InterruptedException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    WorkBean workBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WorkBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    JSONObject jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//判断content这个键是否存在</span>
        
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    
        
        
    workBean<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="5-2-1-读取数据："><a href="#5-2-1-读取数据：" class="headerlink" title="5.2.1 读取数据："></a>5.2.1 读取数据：</h5><p><img src="img/image-20210324105458692.png" alt="image-20210324105458692"></p>
<pre class=" language-java"><code class="language-java">JSONObject json <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
JSONObject jsonObj <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取json数组中的data项  </span>
JSONArray paths <span class="token operator">=</span> jsonObj<span class="token punctuation">.</span><span class="token function">getJSONArray</span><span class="token punctuation">(</span><span class="token string">"carItem"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//把[]那里变为数组</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> paths<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    String carNo <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"carNo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String carColor <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"carColor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Double distance <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token string">"distance"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Double longitude <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token string">"longitude"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Double latitude <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token string">"latitude"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\""</span> <span class="token operator">+</span> carNo <span class="token operator">+</span> <span class="token string">"\""</span> <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>carNo<span class="token operator">+</span><span class="token string">"--"</span><span class="token operator">+</span>carColor <span class="token operator">+</span><span class="token string">"--"</span> <span class="token operator">+</span> distance <span class="token operator">+</span><span class="token string">"-"</span> <span class="token operator">+</span>longitude <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

</code></pre>
<h5 id="5-5-读取Excel文件"><a href="#5-5-读取Excel文件" class="headerlink" title="5.5 读取Excel文件"></a>5.5 读取Excel文件</h5><h5 id="5-4一次性读取多个文件"><a href="#5-4一次性读取多个文件" class="headerlink" title="5.4一次性读取多个文件"></a>5.4一次性读取多个文件</h5><h3 id="6-自动删除文件"><a href="#6-自动删除文件" class="headerlink" title="6.自动删除文件"></a>6.自动删除文件</h3><h4 id="6-1-删除本地的文件"><a href="#6-1-删除本地的文件" class="headerlink" title="6.1 删除本地的文件"></a>6.1 删除本地的文件</h4><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//设置路径</span>
Path path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">"file:///E:\\BigDataCompetition\\测试题\\12-07测试6\\resource\\T03\\output"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//获取文件系统</span>
FileSystem fileSystem <span class="token operator">=</span> FileSystem<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span>getConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//进行判断</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>fileSystem<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    fileSystem<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

</code></pre>
<h4 id="6-2-删除hdfs的文件"><a href="#6-2-删除hdfs的文件" class="headerlink" title="6.2 删除hdfs的文件"></a>6.2 删除hdfs的文件</h4><pre class=" language-java"><code class="language-java">Path path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">"hdfs://ky002:9000/output/t3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//获取hdfs的文件系统</span>
FileSystem fileSystem <span class="token operator">=</span> FileSystem<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">"hdfs://ky002:9000"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>fileSystem<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    fileSystem<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

</code></pre>
<h3 id="7-连接不上hdfs时"><a href="#7-连接不上hdfs时" class="headerlink" title="7.连接不上hdfs时"></a>7.连接不上hdfs时</h3><pre class=" language-java"><code class="language-java">conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"dfs.client.use.datanode.hostname"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="8-mapreduce的HBase"><a href="#8-mapreduce的HBase" class="headerlink" title="8.mapreduce的HBase"></a>8.mapreduce的HBase</h3><h2 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a>Hive</h2><h3 id="1-查询问题"><a href="#1-查询问题" class="headerlink" title="1.查询问题"></a>1.查询问题</h3><p>1.编写HQL语句可以使用case when语句</p>
<pre class=" language-mysql"><code class="language-mysql">方法一：
case 
when tb1.os = 'android' then 'android'
when tb1.os = 'ios' then 'iPhone'
else 'PC'
end as os,

方法二：
case tb1.os
when 'android' then 'android'
when 'ios' then 'iPhone'
else 'PC'
end as os,
</code></pre>
<p>2.使用order by时select后面必须要有相应的字段</p>
<h4 id="1-1-两个表自关联"><a href="#1-1-两个表自关联" class="headerlink" title="1.1 两个表自关联"></a>1.1 两个表自关联</h4><p><strong>1.求同一列的上下行</strong></p>
<p><strong>2.维度表的构建</strong></p>
<h3 id="2-时间问题"><a href="#2-时间问题" class="headerlink" title="2.时间问题"></a>2.时间问题</h3><h4 id="2-1-单独取年，月，日，小时"><a href="#2-1-单独取年，月，日，小时" class="headerlink" title="2.1 单独取年，月，日，小时"></a>2.1 单独取年，月，日，小时</h4><pre class=" language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">//hour()里面放标准的时间，能够得到小时</span>
select hour<span class="token punctuation">(</span><span class="token string">"2020-5-20 12:20:20"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//取年year ， 取月份month和取小时一样</span>
<span class="token comment" spellcheck="true">//结果为</span>
<span class="token number">12</span>

<span class="token comment" spellcheck="true">//时间戳转换 秒级时间戳</span>
select unix_timestamp<span class="token punctuation">(</span><span class="token string">"2020-5-20 12:20:20"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//结果为</span>
<span class="token number">1589948420</span>
</code></pre>
<h4 id="2-2-混合取时间"><a href="#2-2-混合取时间" class="headerlink" title="2.2 混合取时间"></a>2.2 混合取时间</h4><pre class=" language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">//取年份和月份</span>
select date_format<span class="token punctuation">(</span>to_date<span class="token punctuation">(</span><span class="token string">"2020-12-25 10:20:23"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"yyyy-MM"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//结果</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span>

<span class="token comment" spellcheck="true">//若给定时间不为标准格式则转为标准格式</span>
select date_format<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span><span class="token string">"2020/12/25 10:20:23"</span><span class="token punctuation">,</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'yyyy-MM-dd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//结果</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">25</span>
</code></pre>
<h4 id="2-3-时间格式化"><a href="#2-3-时间格式化" class="headerlink" title="2.3 时间格式化"></a>2.3 时间格式化</h4><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//1.date_fomat:格式化时间</span>
select <span class="token function">date_format</span><span class="token punctuation">(</span><span class="token string">'2019-06-29'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="2-3-求周"><a href="#2-3-求周" class="headerlink" title="2.3 求周"></a>2.3 求周</h4><h5 id="2-3-1-求第几周"><a href="#2-3-1-求第几周" class="headerlink" title="2.3.1 求第几周"></a>2.3.1 求第几周</h5><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//根据2019-05-20这种格式的日期统计该日期是2019年的第几周</span>
select <span class="token function">weekofyear</span><span class="token punctuation">(</span><span class="token string">'2019-05-20'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//输出</span>
<span class="token number">21</span>
<span class="token comment" spellcheck="true">//注意：使用时需要注意跨年的时候有异常，比如20181231是周一，结果会输出1，表示为2019年的第一周</span>
</code></pre>
<h5 id="2-3-2"><a href="#2-3-2" class="headerlink" title="2.3.2"></a>2.3.2</h5><p><img src="img/image-20201205192308918.png" alt="image-20201205192308918"></p>
<h4 id="2-4-时间戳"><a href="#2-4-时间戳" class="headerlink" title="2.4 时间戳"></a>2.4 时间戳</h4><h5 id="2-4-1-已知时间求时间戳-秒级时间戳"><a href="#2-4-1-已知时间求时间戳-秒级时间戳" class="headerlink" title="2.4.1 已知时间求时间戳(秒级时间戳)"></a>2.4.1 已知时间求时间戳(秒级时间戳)</h5><pre class=" language-java"><code class="language-java">select <span class="token function">unix_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//获取当前时间戳</span>
select <span class="token function">from_unixtime</span><span class="token punctuation">(</span><span class="token function">unix_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'yyyy-MM-dd HH:mm:ss'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//获取当前时间</span>
    
<span class="token comment" spellcheck="true">//时间是标准格式时   current_timestamp()，unix_timestamp</span>
<span class="token comment" spellcheck="true">//时间戳转换</span>
select <span class="token function">unix_timestamp</span><span class="token punctuation">(</span><span class="token string">"2020-5-20 12:20:20"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//结果为：</span>
<span class="token number">1589948420</span>
    
<span class="token comment" spellcheck="true">//时间不是标准格式时（也可以转为标准格式）</span>
select <span class="token function">unix_timestamp</span><span class="token punctuation">(</span><span class="token string">'2018/06/29 09'</span><span class="token punctuation">,</span> <span class="token string">'yyyy/MM/dd HH'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//结果为：</span>
<span class="token number">1530234000</span>
</code></pre>
<h5 id="2-4-2-已知时间戳求时间-秒级时间戳"><a href="#2-4-2-已知时间戳求时间-秒级时间戳" class="headerlink" title="2.4.2 已知时间戳求时间(秒级时间戳)"></a>2.4.2 已知时间戳求时间(秒级时间戳)</h5><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//1.from_unixtime</span>
select <span class="token function">from_unixtime</span><span class="token punctuation">(</span><span class="token number">1459152333627145</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//2、from_unixtime(int/bigint timestamp, string format) 返回 timestamp 时间戳对应的日期，格式由 format 指定。</span>
select <span class="token function">from_unixtime</span><span class="token punctuation">(</span><span class="token number">1000000000</span><span class="token punctuation">,</span> <span class="token string">'yyyy/MM/dd HH'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//毫秒级时间戳要把秒级时间戳乘以1000</span>
</code></pre>
<h4 id="2-5-时间加减"><a href="#2-5-时间加减" class="headerlink" title="2.5 时间加减"></a>2.5 时间加减</h4><pre><code>//日期增加函数: date_add(string startdate, int days)



//日期减少函数:date_sub (string startdate, int days)
</code></pre>
<h4 id="2-6-获取当前时间"><a href="#2-6-获取当前时间" class="headerlink" title="2.6 获取当前时间"></a>2.6 获取当前时间</h4><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//1. 获取当前时间：yyyy-mm-dd</span>
SELECT CURRENT_DATE<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//2. 获取当月第一天时间：yyyy-mm-dd</span>
select <span class="token function">date_sub</span><span class="token punctuation">(</span>current_date<span class="token punctuation">,</span><span class="token function">dayofmonth</span><span class="token punctuation">(</span>current_date<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//3. 获取下个月第一天时间：yyyy-mm-dd</span>
select <span class="token function">add_months</span><span class="token punctuation">(</span><span class="token function">date_sub</span><span class="token punctuation">(</span>current_date<span class="token punctuation">,</span><span class="token function">dayofmonth</span><span class="token punctuation">(</span>current_date<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//4. 获取当月第几天：yyyy-mm-dd</span>
select <span class="token function">dayofmonth</span><span class="token punctuation">(</span>current_date<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//5. 获取当前日期所在月月末日期：yyyy-mm-dd</span>
select <span class="token function">last_day</span><span class="token punctuation">(</span>current_date<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//6. 获取当前日期本周一：yyyy-mm-dd</span>
select <span class="token function">date_sub</span><span class="token punctuation">(</span><span class="token function">next_day</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">,</span><span class="token string">'MO'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//7. 获取当前日期上周一：yyyy-mm-dd</span>
select <span class="token function">date_sub</span><span class="token punctuation">(</span><span class="token function">next_day</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">,</span><span class="token string">'MO'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//8. 获取当前日期上周日：yyyy-mm-dd</span>
select <span class="token function">date_sub</span><span class="token punctuation">(</span><span class="token function">next_day</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">,</span><span class="token string">'MO'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//9. 获取当前日期本周二：yyyy-mm-dd（获取其他周几调整最后参数）</span>
select <span class="token function">date_sub</span><span class="token punctuation">(</span><span class="token function">next_day</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">,</span><span class="token string">'MO'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//10. 获取当前日期上周二：yyyy-mm-dd（获取其他周几调整最后参数）</span>
select <span class="token function">date_sub</span><span class="token punctuation">(</span><span class="token function">next_day</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">,</span><span class="token string">'MO'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//11. 获取当前时间的前/后几个月时间：yyyy-mm-dd（调整最后参数）</span>
select <span class="token function">add_months</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//12. 开始结束时间相差天数</span>
<span class="token function">datediff</span><span class="token punctuation">(</span>string enddate<span class="token punctuation">,</span> string startdate<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//13. 从开始时间startdate加上days</span>
<span class="token function">date_add</span><span class="token punctuation">(</span>string startdate<span class="token punctuation">,</span> <span class="token keyword">int</span> days<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//14. 从开始时间startdate减去days</span>
<span class="token function">date_sub</span><span class="token punctuation">(</span>string startdate<span class="token punctuation">,</span> <span class="token keyword">int</span> days<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//15. 获取上季度初日期=（quarter方法hive不支持需通过其他方式）</span>
select <span class="token function">add_months</span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">year</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">month</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//16. 获取本季度初日期=（quarter方法hive不支持需通过其他方式）</span>

select <span class="token function">add_months</span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">year</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">month</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//17.取上个季度同今天时间</span>

select <span class="token function">add_months</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//18.去年本季度开始时间</span>

select <span class="token function">add_months</span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">year</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">month</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//19.去年本季度结束时间</span>

select <span class="token function">add_months</span><span class="token punctuation">(</span>CURRENT_DATE<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="3-数学问题"><a href="#3-数学问题" class="headerlink" title="3. 数学问题"></a>3. 数学问题</h3><h4 id="3-1-求百分比，保留n位小数"><a href="#3-1-求百分比，保留n位小数" class="headerlink" title="3.1 求百分比，保留n位小数"></a>3.1 求百分比，保留n位小数</h4><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//保留小数点后2位 * 100，连接% -> 00.00%</span>
<span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">round</span><span class="token punctuation">(</span>x<span class="token operator">/</span>y<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//求百分比，要用到over()开窗函数把总数映射到每个字段</span>
<span class="token comment" spellcheck="true">//可以用sum(count(*))求总数</span>
<span class="token comment" spellcheck="true">//例如：    </span>
select salary<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">avg</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span>
<span class="token function">from</span> <span class="token punctuation">(</span>
select salary<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">over</span><span class="token punctuation">(</span><span class="token punctuation">)</span> total from jobdata_origin<span class="token punctuation">)</span>t 
group by salary<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//有时候求百分比，要用到over()开窗函数把总数映射到每个字段</span>
</code></pre>
<h4 id="3-2-求方差，标准差"><a href="#3-2-求方差，标准差" class="headerlink" title="3.2 求方差，标准差"></a>3.2 求方差，标准差</h4><pre class=" language-java"><code class="language-java"> <span class="token comment" spellcheck="true">//stddev  标准差</span>
hive<span class="token operator">></span> select <span class="token operator">*</span> from dim_row_num limit <span class="token number">10</span><span class="token punctuation">;</span>                  
OK
<span class="token number">0</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">4</span>
<span class="token number">5</span>
<span class="token number">6</span>
<span class="token number">7</span>
<span class="token number">8</span>
<span class="token number">9</span>
    <span class="token comment" spellcheck="true">//标准差</span>
select <span class="token function">stddev</span><span class="token punctuation">(</span>row_num<span class="token punctuation">)</span> from dim_row_num where row_num<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>   
<span class="token comment" spellcheck="true">//方差</span>
select <span class="token function">stddev</span><span class="token punctuation">(</span>row_num<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span> from dim_row_num where row_num<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>   
<span class="token comment" spellcheck="true">//方差2</span>
select <span class="token function">variance</span><span class="token punctuation">(</span>row_num<span class="token punctuation">)</span> form dim_row_num where row_num<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>

</code></pre>
<h4 id="3-3-中位数-众数"><a href="#3-3-中位数-众数" class="headerlink" title="3.3 中位数,众数"></a>3.3 中位数,众数</h4><pre class=" language-java"><code class="language-java">开门见山的说，hive中有两个函数percentile和percentile_approx，可以用来计算分位数。
而中位数即<span class="token number">2</span>分位数，那么同样可以使用该函数计算。具体使用方如下：
percentile：<span class="token function">percentile</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> p<span class="token punctuation">)</span> col是要计算的列（值必须为<span class="token keyword">int</span>类型），p的取值为<span class="token number">0</span><span class="token operator">-</span><span class="token number">1</span>，若为<span class="token number">0.5</span>，那么就是<span class="token number">2</span>分位数，即中位数。

percentile_approx：<span class="token function">percentile_approx</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> p<span class="token punctuation">)</span>。列为数值类型都可以。

percentile_approx还有一种形式<span class="token function">percentile_approx</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> p，B<span class="token punctuation">)</span>，参数B控制内存消耗的近似精度，B越大，结果的精度越高。默认值为<span class="token number">10000</span>。当col字段中的distinct值的个数小于B时，结果就为准确的百分位数

<span class="token comment" spellcheck="true">//例如：</span>
<span class="token comment" spellcheck="true">//职位薪资分析（薪资的平均值、中位数和众数）</span>
select <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">split</span><span class="token punctuation">(</span>salary<span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">split</span><span class="token punctuation">(</span>salary<span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token function">percentile</span><span class="token punctuation">(</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">split</span><span class="token punctuation">(</span>salary<span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">split</span><span class="token punctuation">(</span>salary<span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> AS bigInt<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span>
from jobdata_origin<span class="token punctuation">;</span>    
<span class="token comment" spellcheck="true">//中位数：percentile(cast((split(salary,'-')[0]+split(salary,'-')[1])/2 AS bigInt),0.5)   要转类型</span>

</code></pre>
<h3 id="4-类型转换"><a href="#4-类型转换" class="headerlink" title="4. 类型转换"></a>4. 类型转换</h3><pre class=" language-java"><code class="language-java"><span class="token function">cast</span><span class="token punctuation">(</span>字段<span class="token punctuation">,</span>类型<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//例如把string 转为 int</span>
<span class="token function">cast</span><span class="token punctuation">(</span><span class="token function">year</span><span class="token punctuation">(</span><span class="token function">from_unixtime</span><span class="token punctuation">(</span><span class="token function">unix_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'yyyy-MM-dd HH:mm:ss'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> born as <span class="token keyword">int</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="5-设置reduce个数"><a href="#5-设置reduce个数" class="headerlink" title="5. 设置reduce个数"></a>5. 设置reduce个数</h3><pre class=" language-mysql"><code class="language-mysql">#查看reduce的个数
set mapreduce.job.reduces;
#设置reduce的个数
set mapreduce.job.reduces= 2;

#同步时间
ntpdate -u ntp1.aliyun.com
</code></pre>
<h3 id="6-读取json文件"><a href="#6-读取json文件" class="headerlink" title="6. 读取json文件"></a>6. 读取json文件</h3><p><img src="img/image-20201213205611564.png" alt="image-20201213205611564"></p>
<pre class=" language-mysql"><code class="language-mysql">#要在/export/server/hive/hcatalog/share/hcatalog里面把一个jar包放进hive中
#hive-hcatalog-core-2.1.1.jar
#创建一个json格式的表
create table emp(
id int,
FistName string,
LastName string
)row format serde 'org.apache.hive.hcatalog.data.JsonSerDe';


#第二种
add jar /路径/json-serde-1.3.6-jar-with-dependencies.jar
create table emp(
id int,
FistName string,
LastName string
)row format serde 'org.openx.data.jsonserde.JsonSerDe'
stored as textfile;
</code></pre>
<h3 id="7-处理多个字段的问题"><a href="#7-处理多个字段的问题" class="headerlink" title="7. 处理多个字段的问题"></a>7. 处理多个字段的问题</h3><pre class=" language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">//相当于通过集合来遍历</span>
<span class="token keyword">val</span> names2 <span class="token operator">=</span> <span class="token string">"id\tName\tCtfTp\tCtfId\tGender\tBirthday\tAddress\tZip\tDuty\tMobile\tTel\tFax\tEMail\tNation\tTaste\tEducation\tCompany\tFamily\tVersion\tHotel\tGrade\tDuration\tCity"</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>map<span class="token punctuation">(</span>
        name <span class="token keyword">=></span>
          name      <span class="token comment" spellcheck="true">//这里可以根据题目更改 例如：判断字段是否为空 "isnull("+name+)"</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">" or "</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span>names2<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//输出</span>
<span class="token comment" spellcheck="true">//id or Name or CtfTp or CtfId or Gender or Birthday or Address or Zip or Duty or Mobile or Tel or Fax or EMail or Nation or Taste or Education or Company or Family or Version or Hotel or Grade or Duration or City</span>


</code></pre>
<h3 id="8-一些不熟练的函数的使用"><a href="#8-一些不熟练的函数的使用" class="headerlink" title="8.一些不熟练的函数的使用"></a>8.一些不熟练的函数的使用</h3><h4 id="8-1-instr"><a href="#8-1-instr" class="headerlink" title="8.1 instr"></a>8.1 instr</h4><pre class=" language-mysql"><code class="language-mysql">instr(C1,C2,I,J) #在一个字符串中搜索指定的字符,返回发现指定的字符的位置(返回索引);

#C1    被搜索的字符串
#C2    希望搜索的字符串
#I     搜索的开始位置,默认为1
#J     出现的位置,默认为1

#可以使用instr函数去判断字符串中是否包含某个字符 和case when 联合使用
例如：
case when instr('15K-20K','-')!= -1 then ...
</code></pre>
<h4 id="8-2-repeat"><a href="#8-2-repeat" class="headerlink" title="8.2 repeat"></a>8.2 repeat</h4><pre class=" language-mysql"><code class="language-mysql">#重复字符串函数：repeat
语法: repeat(string str, int n)
返回值: string
#说明：返回重复 n 次后的 str 字符串
举例：
hive> select repeat('abc',5) from lxw1234;
abcabcabcabcabc
</code></pre>
<h4 id="8-3-扁平化-explode"><a href="#8-3-扁平化-explode" class="headerlink" title="8.3 扁平化 explode"></a>8.3 扁平化 explode</h4><pre class=" language-mysql"><code class="language-mysql">#把行转为列
explode(split(repeat(smon,emon-smon+1),''))

#输出   repeat(smon,emon-smon+1) => 555
5
5
5

#explode表生产函数
1.对福利标签字段内容进行扁平化处理
["午餐补助","定期体检","带薪年假","五险一金","六险一金","带薪病假","年假","工作氛围好"]
create table tmp_company as select explode(jo.advantage)
from jobdata_origin jo;

select * from tmp_company;

午餐补助
定期体检
带薪年假...
</code></pre>
<h4 id="8-4-泛化"><a href="#8-4-泛化" class="headerlink" title="8.4 泛化"></a>8.4 泛化</h4><pre class=" language-mysql"><code class="language-mysql">create table tmp_salarylist as  
select col,case when col>=0 and col<=5 then "0-5"  
when col>=6 and col<=10 then "6-10"  
when col>=11 and col<=15 then "11-15"  
when col>=16 and col<=20 then "16-20"  
when col>=21 and col<=25 then "21-25"  
when col>=26 and col<=30 then "26-30"  
when col>=31 and col<=35 then "31-35"  
when col>=36 and col<=40 then "36-40"  
when col>=41 and col<=45 then "41-45"  
when col>=46 and col<=50 then "46-50" 
when col>=51 and col<=55 then "51-55"  
when col>=56 and col<=60 then "56-60"  
when col>=61 and col<=65 then "61-65"  
when col>=66 and col<=70 then "66-70"  
when col>=71 and col<=75 then "71-75"  
when col>=76 and col<=80 then "76-80"  
when col>=81 and col<=85 then "81-85"  
when col>=86 and col<=90 then "86-90"  
when col>=91 and col<=95 then "91-95"  
when col>=96 and col<=100 then "96-100"  
when col>=101 then ">101" end from tmp_salary;


</code></pre>
<h4 id="8-5-聚合函数"><a href="#8-5-聚合函数" class="headerlink" title="8.5 聚合函数"></a>8.5 聚合函数</h4><table>
<thead>
<tr>
<th align="center">函数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>count(*)</code></td>
<td>计算总行数，包括含有Null值的行</td>
</tr>
<tr>
<td align="center"><code>sum(col)</code></td>
<td>指定行的值的和</td>
</tr>
<tr>
<td align="center"><code>avg(col)</code></td>
<td>指定行的值的平均值</td>
</tr>
<tr>
<td align="center"><code>min(col)</code></td>
<td>指定行的值的最小值</td>
</tr>
<tr>
<td align="center"><code>max(col)</code></td>
<td>指定行的值的最大值</td>
</tr>
<tr>
<td align="center"><code>variance(col)</code></td>
<td>返回col一组数值的方差</td>
</tr>
<tr>
<td align="center"><code>var_samp(col)</code></td>
<td>返回col一组数值的样本方差</td>
</tr>
<tr>
<td align="center"><code>stddev(col)</code></td>
<td>返回col一组数值的标准差</td>
</tr>
<tr>
<td align="center"><code>stddev_pop(col)</code></td>
<td>返回一组数值的标准偏差</td>
</tr>
<tr>
<td align="center"><code>stddev_samp(col)</code></td>
<td>标准样本偏差</td>
</tr>
<tr>
<td align="center"><code>covar_pop(col1,col2)</code></td>
<td>协方差</td>
</tr>
<tr>
<td align="center"><code>covar_samp(col1,col2)</code></td>
<td>样本协方差</td>
</tr>
<tr>
<td align="center"><code>corr(col1,col2)</code></td>
<td>相关系数</td>
</tr>
<tr>
<td align="center"><code>percentile(col,p)</code></td>
<td>数据col中对应p的位置，p∈[0,1]</td>
</tr>
<tr>
<td align="center"><code>collect_set(col)</code></td>
<td>col排重后聚合在一个Array里</td>
</tr>
<tr>
<td align="center"><code>distinct(col)</code></td>
<td>去重</td>
</tr>
</tbody></table>
<h4 id="8-6-UNION"><a href="#8-6-UNION" class="headerlink" title="8.6 UNION"></a>8.6 UNION</h4><p><em><strong>UNION操作符用于合并两个或多个 SELECT 语句的结果集。</strong></em></p>
<h4 id="7-6-cascade-删除非空数据库"><a href="#7-6-cascade-删除非空数据库" class="headerlink" title="7.6 cascade 删除非空数据库"></a>7.6 cascade 删除非空数据库</h4><pre class=" language-mysql"><code class="language-mysql">drop database db_hive cascade;
</code></pre>
<h4 id="7-7-like，array-contains"><a href="#7-7-like，array-contains" class="headerlink" title="7.7 like，array_contains"></a>7.7 like，array_contains</h4><p><strong>判断一个字符串是否包含指定字符</strong></p>
<h4 id="7-8-collect-list-collect-set"><a href="#7-8-collect-list-collect-set" class="headerlink" title="7.8 collect_list,collect_set"></a>7.8 collect_list,collect_set</h4><p><strong>select collect_list(‘1’,‘2’,‘3’) -&gt;[“1,2,3”] 返回是一个list</strong></p>
<blockquote>
<p>不同的是collect_list不去重而collect_set去重</p>
</blockquote>
<h3 id="9-在hive中执行脚本"><a href="#9-在hive中执行脚本" class="headerlink" title="9. 在hive中执行脚本"></a>9. 在hive中执行脚本</h3><pre class=" language-mysql"><code class="language-mysql">#脚本名字：t.sql
#在hive的外部
hive -f t.sql

#在hive的里面运行脚本
source t.sql
</code></pre>
<h3 id="10-自定义函数UDF"><a href="#10-自定义函数UDF" class="headerlink" title="10.自定义函数UDF"></a>10.自定义函数UDF</h3><pre class=" language-mysql"><code class="language-mysql">#7.1 自定义函数
#添加 jar
add jar linux_jar_path  #jar包的路径
#创建 function，
create [temporary] function [dbname.]function_name AS '自定义UDF的全类名';
</code></pre>
<p>案例</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>ql<span class="token punctuation">.</span>exec<span class="token punctuation">.</span>UDF<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetLength</span> <span class="token keyword">extends</span> <span class="token class-name">UDF</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>String str<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">catch</span><span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="11-窗口函数"><a href="#11-窗口函数" class="headerlink" title="11.窗口函数"></a>11.窗口函数</h3><blockquote>
<p><strong>应用场景：</strong><br>（1）用于分区排序<br>（2）动态Group By<br>（3）Top N<br>（4）累计计算<br>（5）层次查询</p>
</blockquote>
<pre class=" language-mysql"><code class="language-mysql">#例如求TopN 分组
select *
from(
select 
'2020-04-12',
province,
city,
count(orderid) as total_cnt,
row_number() over(partition by province order by count(orderid)) rn
from dw_didi.t_user_order_wide
group by province,city
)t
where t.rn <= 3
</code></pre>
<h3 id="12-查询时插入数据"><a href="#12-查询时插入数据" class="headerlink" title="12.查询时插入数据"></a>12.查询时插入数据</h3><h3 id="13-多表查询"><a href="#13-多表查询" class="headerlink" title="13.多表查询"></a>13.多表查询</h3><h2 id="Spark"><a href="#Spark" class="headerlink" title="Spark"></a>Spark</h2><h3 id="spark-的使用"><a href="#spark-的使用" class="headerlink" title="spark 的使用"></a>spark 的使用</h3><pre class=" language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">//1.创建sparkConf</span>
<span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"educoder1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local"</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> sc<span class="token operator">=</span><span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//如果涉及到HDFS 权限问题不能写入，需要执行：</span>
<span class="token comment" spellcheck="true">//hadoop fs -chmod -R 777 /</span>
<span class="token comment" spellcheck="true">//并添加如下代码</span>
System<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">"HADOOP_USER_NAME"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">)</span>
result<span class="token punctuation">.</span>repartition<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span>args<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//提交任务时需要指定output参数</span>
</code></pre>
<h3 id="1-访问mysql"><a href="#1-访问mysql" class="headerlink" title="1. 访问mysql"></a>1. 访问mysql</h3><pre class=" language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">//建表后创建一个用户所有地方都可以访问</span>
create user <span class="token string">'spark'</span>@<span class="token string">'%'</span> identified by <span class="token string">'spark'</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//赋予权限</span>
grant all on sparkbase<span class="token punctuation">.</span>* to <span class="token string">'spark'</span>@<span class="token string">'%'</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//读取mysql中的数据</span>
<span class="token keyword">val</span> data <span class="token operator">=</span> spark<span class="token punctuation">.</span>read
                <span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">"jdbc"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"driver"</span><span class="token punctuation">,</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span><span class="token string">"jdbc:mysql://localhost:3306/数据库名?serverTimezone=UTC"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"dbtable"</span><span class="token punctuation">,</span><span class="token string">"表名"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>



</code></pre>
<h3 id="2-连接hive"><a href="#2-连接hive" class="headerlink" title="2. 连接hive"></a>2. 连接hive</h3><pre class=" language-scala"><code class="language-scala">
<span class="token comment" spellcheck="true">//启动 Hive MetaStore</span>
nohup <span class="token operator">/</span>export<span class="token operator">/</span>servers<span class="token operator">/</span>hive<span class="token operator">/</span>bin<span class="token operator">/</span>hive <span class="token operator">--</span>service metastore <span class="token number">2</span><span class="token operator">></span><span class="token operator">&amp;</span><span class="token number">1</span> <span class="token operator">>></span> <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token punctuation">.</span>log <span class="token operator">&amp;</span>
<span class="token comment" spellcheck="true">//第二种启动方法在hive的bin目录下</span>
<span class="token punctuation">.</span>/hive <span class="token operator">--</span>service metastore <span class="token operator">&amp;</span>

<span class="token comment" spellcheck="true">//spark中的代码</span>
<span class="token keyword">val</span> spark <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"product"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>config<span class="token punctuation">(</span><span class="token string">"hive.metastore.uris"</span><span class="token punctuation">,</span><span class="token string">"thrift://ky002:9083"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>config<span class="token punctuation">(</span><span class="token string">"spark.sql.warehouse.dir"</span><span class="token punctuation">,</span><span class="token string">"hdfs://ky002:9000/user/hive/warehouse"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>enableHiveSupport<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//隐式转换</span>
<span class="token keyword">import</span> spark<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span>_


<span class="token comment" spellcheck="true">//将数据存入hive中 resultDF为目标数据</span>
resultDF<span class="token punctuation">.</span>write<span class="token punctuation">.</span>mode<span class="token punctuation">(</span>SaveMode<span class="token punctuation">.</span>OverWrite<span class="token punctuation">)</span><span class="token punctuation">.</span>saveAsTable<span class="token punctuation">(</span><span class="token string">"库名.表名"</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true">//在虚拟机中连接hive</span>
 bin<span class="token operator">/</span>spark<span class="token operator">-</span>shell <span class="token operator">--</span>driver<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>path jars<span class="token operator">/</span>mysql<span class="token operator">-</span>connector<span class="token operator">-</span>java<span class="token operator">-</span><span class="token number">5.1</span><span class="token punctuation">.</span><span class="token number">38</span><span class="token punctuation">.</span>jar <span class="token operator">--</span>files conf<span class="token operator">/</span>hive<span class="token operator">-</span>site<span class="token punctuation">.</span>xml

<span class="token comment" spellcheck="true">//解决版本问题</span>
</code></pre>
<p><img src="img/image-20210518210518054.png" alt="image-20210518210518054"></p>
<h3 id="3-spark-RDD时间格式的转换"><a href="#3-spark-RDD时间格式的转换" class="headerlink" title="3.spark RDD时间格式的转换"></a>3.spark RDD时间格式的转换</h3><pre class=" language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">//把时间变为时间戳</span>
<span class="token keyword">val</span> format1 <span class="token operator">=</span> <span class="token keyword">new</span> SimpleDateFormat<span class="token punctuation">(</span><span class="token string">"yyyyMMdd"</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> str <span class="token operator">=</span> <span class="token string">"2020520"</span>
<span class="token keyword">val</span> timsimple <span class="token operator">=</span> format1<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span>getTime <span class="token comment" spellcheck="true">//13位</span>

<span class="token comment" spellcheck="true">//把时间戳变为时间</span>
<span class="token keyword">val</span> format2 <span class="token operator">=</span> <span class="token keyword">new</span> SimpleDateFormat<span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span>

<span class="token keyword">val</span> time <span class="token operator">=</span> format2<span class="token punctuation">.</span>format<span class="token punctuation">(</span>timsimple<span class="token punctuation">)</span>

</code></pre>
<p>不会用rdd清洗数据</p>
<h3 id="4-Spark-读文件"><a href="#4-Spark-读文件" class="headerlink" title="4.Spark 读文件"></a>4.Spark 读文件</h3><h4 id="4-1-SparkRDD-读json"><a href="#4-1-SparkRDD-读json" class="headerlink" title="4.1 SparkRDD 读json"></a>4.1 SparkRDD 读json</h4><pre class=" language-SCALA"><code class="language-SCALA">
</code></pre>
<h4 id="4-2-SparkSQL-读json"><a href="#4-2-SparkSQL-读json" class="headerlink" title="4.2 SparkSQL 读json"></a>4.2 SparkSQL 读json</h4><pre class=" language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">//一行一行的json</span>
spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//多行json</span>
spark<span class="token punctuation">.</span>read
    <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"multiLine"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"mode"</span><span class="token punctuation">,</span><span class="token string">"permissive"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="4-3-Spark-RDD-读取csv-txt等文件"><a href="#4-3-Spark-RDD-读取csv-txt等文件" class="headerlink" title="4.3 Spark RDD 读取csv,txt等文件"></a>4.3 Spark RDD 读取csv,txt等文件</h4><pre class=" language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">//遇到没有表头的文件时要使用 case class Cloumns() 定义表头 要在类的外面定义</span>
<span class="token comment" spellcheck="true">//例如：</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
spark<span class="token punctuation">.</span>sparkContext<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">"E:\\BigDataCompetition\\测试题\\综合1_echarts\\datashow2\\spark\\spark\\部分数据.txt"</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" &amp;#123;4&amp;#125;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>filter<span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> items <span class="token keyword">=></span>
        <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>items<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span>item <span class="token keyword">&lt;-</span> items<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> item<span class="token punctuation">.</span>equals<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
              flag <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
          <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
          flag <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
        flag
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      fields <span class="token keyword">=></span>
        Column<span class="token punctuation">(</span>
          fields<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          fields<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>toDF<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createOrReplaceTempView<span class="token punctuation">(</span><span class="token string">"table1"</span><span class="token punctuation">)</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token keyword">case</span> <span class="token keyword">class</span> Column<span class="token punctuation">(</span>bb_id<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>job_name<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>salary<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>welfare<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>workingExp<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>edu<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>emplType<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="4-4-Spark-SQL-读csv-txt文件"><a href="#4-4-Spark-SQL-读csv-txt文件" class="headerlink" title="4.4 Spark SQL 读csv,txt文件"></a>4.4 Spark SQL 读csv,txt文件</h4><pre class=" language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">//用sql读取文件时要注意分隔符，要把文件分割</span>

spark<span class="token punctuation">.</span>read
    <span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">"csv"</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//</span>
    <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"sep"</span><span class="token punctuation">,</span><span class="token string">"\t"</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">//分割符</span>
    <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"header"</span><span class="token punctuation">,</span><span class="token string">"true"</span><span class="token punctuation">)</span>

    <span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"E:\\BigDataCompetition\\测试题\\综合2_requests\\测试2\\dataAnalyze\\taxi_data"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>createOrReplaceTempView<span class="token punctuation">(</span><span class="token string">"table1"</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="5-sparkSQL-option的应用"><a href="#5-sparkSQL-option的应用" class="headerlink" title="5. sparkSQL option的应用"></a>5. sparkSQL option的应用</h3><pre class=" language-SCALA"><code class="language-SCALA">//遇到要过滤字段长度不足的数据时
.option("mode","DROPMALFORMED")

//当数据过多时可以用sample(0.1)抽样
</code></pre>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td><strong><code>sep</code></strong></td>
<td>默认是<code>,</code> 指定单个字符分割字段和值</td>
</tr>
<tr>
<td><strong><code>encoding</code></strong></td>
<td>默认是<code>uft-8</code>通过给定的编码类型进行解码</td>
</tr>
<tr>
<td><strong><code>quote</code></strong></td>
<td>默认是<code>“</code>，其中分隔符可以是值的一部分，设置用于转义带引号的值的单个字符。如果您想关闭引号，则需要设置一个空字符串，而不是<code>null</code>。</td>
</tr>
<tr>
<td><strong><code>escape</code></strong></td>
<td>默认(<code>\</code>)设置单个字符用于在引号里面转义引号</td>
</tr>
<tr>
<td><strong><code>charToEscapeQuoteEscaping</code></strong></td>
<td>默认是转义字符（上面的<code>escape</code>）或者<code>\0</code>，当转义字符和引号(<code>quote</code>)字符不同的时候，默认是转义字符(escape)，否则为<code>\0</code></td>
</tr>
<tr>
<td><strong><code>comment</code></strong></td>
<td>默认是空值，设置用于跳过行的单个字符，以该字符开头。默认情况下，它是禁用的</td>
</tr>
<tr>
<td><strong><code>header</code></strong></td>
<td>默认是<code>false</code>，将第一行作为列名</td>
</tr>
<tr>
<td><strong><code>enforceSchema</code></strong></td>
<td>默认是<code>true</code>， 如果将其设置为<code>true</code>，则指定或推断的模式将强制应用于数据源文件，而<code>CSV</code>文件中的标头将被忽略。 如果选项设置为<code>false</code>，则在<code>header</code>选项设置为<code>true</code>的情况下，将针对CSV文件中的所有标题验证模式。模式中的字段名称和CSV标头中的列名称是根据它们的位置检查的，并考虑了*<code>spark.sql.caseSensitive</code>。虽然默认值为<code>true</code>，但是建议禁用 <code>enforceSchema</code>选项，以避免产生错误的结果</td>
</tr>
<tr>
<td><strong><code>inferSchema</code></strong></td>
<td>inferSchema<code>（默认为</code>false`）：从数据自动推断输入模式。 *需要对数据进行一次额外的传递</td>
</tr>
<tr>
<td><strong><code>samplingRatio</code></strong></td>
<td>默认为<code>1.0</code>,定义用于模式推断的行的分数</td>
</tr>
<tr>
<td><strong><code>ignoreLeadingWhiteSpace</code></strong></td>
<td>默认为<code>false</code>,一个标志，指示是否应跳过正在读取的值中的前导空格</td>
</tr>
<tr>
<td><strong><code>ignoreTrailingWhiteSpace</code></strong>*</td>
<td>默认为<code>false</code>一个标志，指示是否应跳过正在读取的值的结尾空格</td>
</tr>
<tr>
<td><strong><code>nullValue</code></strong></td>
<td>默认是空的字符串,设置null值的字符串表示形式。从2.0.1开始，这适用于所有支持的类型，包括字符串类型</td>
</tr>
<tr>
<td><strong><code>emptyValue</code></strong></td>
<td>默认是空字符串,设置一个空值的字符串表示形式</td>
</tr>
<tr>
<td><strong><code>nanValue</code></strong></td>
<td>默认是<code>Nan</code>,设置非数字的字符串表示形式</td>
</tr>
<tr>
<td><strong><code>positiveInf</code></strong></td>
<td>默认是<code>Inf</code></td>
</tr>
<tr>
<td><strong><code>negativeInf</code></strong></td>
<td>默认是<code>-Inf</code> 设置负无穷值的字符串表示形式</td>
</tr>
<tr>
<td><strong><code>dateFormat</code></strong></td>
<td>默认是<code>yyyy-MM-dd</code>,设置指示日期格式的字符串。自定义日期格式遵循<code>java.text.SimpleDateFormat</code>中的格式。这适用于日期类型</td>
</tr>
<tr>
<td><strong><code>timestampFormat</code></strong></td>
<td>默认是<code>yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSXXX</code>，设置表示时间戳格式的字符串。自定义日期格式遵循<code>java.text.SimpleDateFormat</code>中的格式。这适用于时间戳记类型</td>
</tr>
<tr>
<td><strong><code>maxColumns</code></strong></td>
<td>默认是<code>20480</code>定义多少列数目的硬性设置</td>
</tr>
<tr>
<td><strong><code>maxCharsPerColumn</code></strong></td>
<td>默认是<code>-1</code>定义读取的任何给定值允许的最大字符数。默认情况下为-1，表示长度不受限制</td>
</tr>
<tr>
<td><strong><code>mode</code></strong></td>
<td>默认（允许）允许一种在解析过程中处理损坏记录的模式。它支持以下不区分大小写的模式。请注意，<code>Spark</code>尝试在列修剪下仅解析<code>CSV</code>中必需的列。因此，损坏的记录可以根据所需的字段集而有所不同。可以通过<code>spark.sql.csv.parser.columnPruning.enabled</code>（默认启用）来控制此行为。</td>
</tr>
<tr>
<td>mode下面的参数:</td>
<td>—————————————————</td>
</tr>
<tr>
<td><strong><code>PERMISSIVE</code></strong></td>
<td>当它遇到损坏的记录时，将格式错误的字符串放入由“ columnNameOfCorruptRecord”配置的*字段中，并将其他字段设置为“ null”。为了保留损坏的记录，用户可以在用户定义的模式中设置一个名为<code>columnNameOfCorruptRecord</code></td>
</tr>
<tr>
<td><strong><code>DROPMALFORMED</code></strong></td>
<td>忽略整个损坏的记录</td>
</tr>
<tr>
<td><strong><code>FAILFAST</code></strong></td>
<td>遇到损坏的记录时引发异常</td>
</tr>
<tr>
<td>mode参数结束</td>
<td>——————————————————-</td>
</tr>
<tr>
<td><strong><code>columnNameOfCorruptRecord</code></strong></td>
<td>默认值指定在<code>spark.sql.columnNameOfCorruptRecord</code>,允许重命名由<code>PERMISSIVE</code>模式创建的格式错误的新字段。这会覆盖<code>spark.sql.columnNameOfCorruptRecord</code></td>
</tr>
<tr>
<td><strong><code>multiLine</code></strong></td>
<td>默认是<code>false</code>,解析一条记录，该记录可能跨越多行</td>
</tr>
</tbody></table>
<h3 id="6-sparkSQL-DataFrame的常用操作"><a href="#6-sparkSQL-DataFrame的常用操作" class="headerlink" title="6.sparkSQL DataFrame的常用操作"></a>6.sparkSQL DataFrame的常用操作</h3><p><img src="img/image-20210507195222017.png" alt="image-20210507195222017"></p>
<h4 id="6-1-注册临时表"><a href="#6-1-注册临时表" class="headerlink" title="6.1 注册临时表"></a>6.1 注册临时表</h4><p><img src="img/image-20210507202458025.png" alt="image-20210507202458025"></p>
<h4 id="6-2-使用sql"><a href="#6-2-使用sql" class="headerlink" title="6.2 使用sql"></a>6.2 使用sql</h4><p><img src="img/image-20210507203226808.png" alt="image-20210507203226808"></p>
<p><img src="img/image-20210507203247002.png" alt="image-20210507203247002"></p>
<p><img src="img/image-20210507203304932.png" alt="image-20210507203304932"></p>
<p><strong>其中col为DF对象的名字</strong></p>
<h4 id="6-3-代码例题（用到样例类）"><a href="#6-3-代码例题（用到样例类）" class="headerlink" title="6.3 代码例题（用到样例类）"></a>6.3 代码例题（用到样例类）</h4><pre class=" language-scala"><code class="language-scala"><span class="token keyword">package</span> Spark<span class="token punctuation">.</span>SQL<span class="token punctuation">.</span>Base

<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>SparkContext
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>JavaSparkContext<span class="token punctuation">.</span>fromSparkContext
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span>DataFrame<span class="token punctuation">,</span> SparkSession<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token keyword">object</span> createDataFrame <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//1.创建SparkSession 对象</span>
    <span class="token keyword">val</span> spark<span class="token operator">:</span> SparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> spark<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span>_
    <span class="token comment" spellcheck="true">//获取</span>
    <span class="token keyword">val</span> sc<span class="token operator">:</span> SparkContext <span class="token operator">=</span> spark<span class="token punctuation">.</span>sparkContext
    <span class="token comment" spellcheck="true">//设置打印级别</span>
    sc<span class="token punctuation">.</span>setLogLevel<span class="token punctuation">(</span><span class="token string">"WARN"</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> personRDD1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">"D:\\QQ\\消息记录\\1290353847\\FileRecv\\person.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> personRDD2 <span class="token operator">=</span> personRDD1<span class="token punctuation">.</span>map<span class="token punctuation">(</span>x<span class="token keyword">=></span> Person<span class="token punctuation">(</span>x<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toInt<span class="token punctuation">,</span>x<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toInt<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> personDF <span class="token operator">=</span> personRDD2<span class="token punctuation">.</span>toDF<span class="token punctuation">(</span><span class="token punctuation">)</span>
    personDF<span class="token punctuation">.</span>createOrReplaceTempView<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span>

    spark<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">"select * from user where age&lt;20"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">//关闭资源</span>
    sc<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    spark<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//    //从mysql读数据</span>
<span class="token comment" spellcheck="true">//    val data = spark.read</span>
<span class="token comment" spellcheck="true">//      .format("jdbc")</span>
<span class="token comment" spellcheck="true">//      .option("driver", "com.mysql.jdbc.Driver")</span>
<span class="token comment" spellcheck="true">//      .option("url", "jdbc:mysql://localhost:3306/spark02?serverTimezone=UTC")</span>
<span class="token comment" spellcheck="true">//      .option("dbtable", "student")</span>
<span class="token comment" spellcheck="true">//      .option("user", "root")</span>
<span class="token comment" spellcheck="true">//      .option("password", "123456").load()</span>
<span class="token comment" spellcheck="true">//</span>
<span class="token comment" spellcheck="true">//    data.show()</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token keyword">class</span> Person<span class="token punctuation">(</span>id<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>结果</strong></p>
<p><img src="img/image-20210507210141779.png" alt="image-20210507210141779"></p>
<h4 id="6-4-schema"><a href="#6-4-schema" class="headerlink" title="6.4 schema"></a>6.4 schema</h4><pre class=" language-scala"><code class="language-scala">    <span class="token keyword">val</span> personRDD1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">"D:\\IntelliJ IDEA\\IDEAC\\code\\MySpark\\src\\main\\java\\Spark\\SQL\\Base\\data\\person.txt"</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> personRDD2 <span class="token operator">=</span> personRDD1<span class="token punctuation">.</span>map<span class="token punctuation">(</span>x<span class="token keyword">=></span>Row<span class="token punctuation">(</span>x<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toInt<span class="token punctuation">,</span>x<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toInt<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> schema<span class="token operator">:</span>StructType <span class="token operator">=</span> StructType<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span>
      StructField<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span>IntegerType<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      StructField<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span>StringType<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      StructField<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span>IntegerType<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> personDF <span class="token operator">=</span> spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>personRDD2<span class="token punctuation">,</span> schema<span class="token punctuation">)</span>
</code></pre>
<h3 id="7-spark在集群中运行的步骤"><a href="#7-spark在集群中运行的步骤" class="headerlink" title="7.spark在集群中运行的步骤"></a>7.spark在集群中运行的步骤</h3><pre class=" language-MYSQL"><code class="language-MYSQL">#在hive的bin目录下
./hive --service metastore &

#运行jar包
bin/spark-submit --master spark://ky002:7077  --class Practice.Parctice01.FilghtClean /hivedata/MyScala.jar

bin/spark-submit --master spark://node:7077  --class Spark.wordcount.WordCount02 /root/input/MySpark.jar /input/word /wcoutput/output  #/input/word为输入路径 /wcoutput/output输出目录

./spark-submit --master 本地模式 --class 程序运行的主类名 xxx.jar
</code></pre>
<h3 id="8-自动删除hdfs文件"><a href="#8-自动删除hdfs文件" class="headerlink" title="8.自动删除hdfs文件"></a>8.自动删除hdfs文件</h3><pre class=" language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">//自动删除hdfs的文件</span>
<span class="token keyword">val</span> fileSystem <span class="token operator">=</span> FileSystem<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token keyword">new</span> URI<span class="token punctuation">(</span><span class="token string">"hdfs://node:9000"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> Configuration<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>fileSystem<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token keyword">new</span> Path<span class="token punctuation">(</span>args<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    fileSystem<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token keyword">new</span> Path<span class="token punctuation">(</span>args<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="spark清洗例题"><a href="#spark清洗例题" class="headerlink" title="spark清洗例题"></a>spark清洗例题</h3><h4 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h4><p><img src="https://cdn.jsdelivr.net/gh/qinmeier/imager/img/20210923111438.png" alt="image-20210923111428083"></p>
<pre class=" language-scala"><code class="language-scala"><span class="token keyword">package</span> cn<span class="token punctuation">.</span>hnkjxy

<span class="token keyword">import</span> java<span class="token punctuation">.</span>text<span class="token punctuation">.</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span>ParseException<span class="token punctuation">,</span> SimpleDateFormat<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span>Calendar<span class="token punctuation">,</span> Date<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>Configuration
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs<span class="token punctuation">.</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span>FileSystem<span class="token punctuation">,</span> Path<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token keyword">object</span> CleanData <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//TODO 1.env/准备sc/SparkContext/Spark上下文执行环境</span>
    <span class="token keyword">val</span> conf<span class="token operator">:</span> SparkConf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"wc"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc<span class="token operator">:</span> SparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span>setLogLevel<span class="token punctuation">(</span><span class="token string">"WARN"</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> java<span class="token punctuation">.</span>text<span class="token punctuation">.</span>DecimalFormat
    <span class="token keyword">val</span> df <span class="token operator">=</span> <span class="token keyword">new</span> DecimalFormat<span class="token punctuation">(</span><span class="token string">"#.##"</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> lines <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">"C:\\Users\\12903\\Desktop\\movies.csv"</span><span class="token punctuation">)</span>

    <span class="token keyword">val</span> result <span class="token operator">=</span> lines<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>filter<span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> items <span class="token keyword">=></span>
        <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>item <span class="token keyword">&lt;-</span> items<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">"零点场"</span><span class="token punctuation">)</span> <span class="token operator">||</span> item<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">"点映"</span><span class="token punctuation">)</span> <span class="token operator">||</span> item<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">"展映"</span><span class="token punctuation">)</span> <span class="token operator">||</span> item<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">"重映"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            flag <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
        flag <span class="token comment" spellcheck="true">//去除脏数据</span>
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
      <span class="token comment" spellcheck="true">//增加字段</span>
      <span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> items <span class="token keyword">=></span>
      <span class="token keyword">var</span> boxoffice <span class="token operator">=</span> <span class="token string">""</span>
      <span class="token keyword">var</span> total_boxoffice <span class="token operator">=</span> <span class="token string">""</span>
      <span class="token keyword">var</span> releaseDate <span class="token operator">=</span> <span class="token string">""</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>items<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span>equals<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span> releaseDate <span class="token operator">=</span> <span class="token string">"往期电影"</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>items<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"上映首日"</span><span class="token punctuation">)</span> releaseDate <span class="token operator">=</span> items<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
      <span class="token keyword">else</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">val</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> SimpleDateFormat<span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> instance <span class="token operator">=</span> Calendar<span class="token punctuation">.</span>getInstance
        <span class="token comment" spellcheck="true">//获得天数</span>
        <span class="token keyword">val</span> substring <span class="token operator">=</span> items<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span>substring<span class="token punctuation">(</span>items<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span><span class="token string">"映"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> items<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span><span class="token string">"天"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span>
          instance<span class="token punctuation">.</span>setTime<span class="token punctuation">(</span><span class="token keyword">new</span> Date<span class="token punctuation">(</span>sdf<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>items<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getTime<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//</span>
        <span class="token keyword">catch</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
          <span class="token keyword">case</span> e<span class="token operator">:</span> ParseException <span class="token keyword">=></span>
            e<span class="token punctuation">.</span>printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
        instance<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Calendar<span class="token punctuation">.</span>DAY_OF_MONTH<span class="token punctuation">,</span> <span class="token operator">-</span>substring<span class="token punctuation">.</span>toInt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//求出releaseDate</span>
        releaseDate <span class="token operator">=</span> sdf<span class="token punctuation">.</span>format<span class="token punctuation">(</span>instance<span class="token punctuation">.</span>getTime<span class="token punctuation">)</span>
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//票房处理</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>items<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">"万"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        boxoffice <span class="token operator">=</span> items<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replaceAll<span class="token punctuation">(</span><span class="token string">"万"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        total_boxoffice <span class="token operator">=</span> df<span class="token punctuation">.</span>format<span class="token punctuation">(</span>items<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replaceAll<span class="token punctuation">(</span><span class="token string">"亿"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toDouble <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span>
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>items<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">"万"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        boxoffice <span class="token operator">=</span> items<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replaceAll<span class="token punctuation">(</span><span class="token string">"万"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        total_boxoffice <span class="token operator">=</span> df<span class="token punctuation">.</span>format<span class="token punctuation">(</span>items<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replaceAll<span class="token punctuation">(</span><span class="token string">"亿"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toDouble <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span>
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
      Column<span class="token punctuation">(</span>
        items<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        boxoffice<span class="token punctuation">,</span>
        items<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        items<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        items<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        items<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        items<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        total_boxoffice<span class="token punctuation">,</span>
        items<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        items<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        releaseDate
      <span class="token punctuation">)</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>x<span class="token keyword">=></span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>movie_name<span class="token punctuation">,</span>x<span class="token punctuation">.</span>boxoffice<span class="token punctuation">,</span>x<span class="token punctuation">.</span>box_rate<span class="token punctuation">,</span>x<span class="token punctuation">.</span>sessions<span class="token punctuation">,</span>x<span class="token punctuation">.</span>show_count_rate<span class="token punctuation">,</span>x<span class="token punctuation">.</span>avg_number<span class="token punctuation">,</span>x<span class="token punctuation">.</span>attendance<span class="token punctuation">,</span>x<span class="token punctuation">.</span>total_boxoffice<span class="token punctuation">,</span>x<span class="token punctuation">.</span>movie_days<span class="token punctuation">,</span>x<span class="token punctuation">.</span>current_time<span class="token punctuation">,</span>x<span class="token punctuation">.</span>releaseDate<span class="token punctuation">)</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">"清洗后文件还有%d行"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>result<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">//自动删除文件</span>
    <span class="token keyword">val</span> path <span class="token operator">=</span> <span class="token keyword">new</span> Path<span class="token punctuation">(</span><span class="token string">"D:\\IntelliJ IDEA\\IDEAC\\code\\MySpark\\src\\main\\java\\cn\\hnkjxy\\output"</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> fileSystem <span class="token operator">=</span> FileSystem<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token keyword">new</span> Configuration<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fileSystem<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      fileSystem<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>repartition<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">"D:\\IntelliJ IDEA\\IDEAC\\code\\MySpark\\src\\main\\java\\cn\\hnkjxy\\output"</span><span class="token punctuation">)</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token keyword">class</span> Column<span class="token punctuation">(</span>movie_name<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>boxoffice<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>box_rate<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>sessions<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>show_count_rate<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>avg_number<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>attendance<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>total_boxoffice<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>movie_days<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>current_time<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>releaseDate<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="不熟练的地方"><a href="#不熟练的地方" class="headerlink" title="不熟练的地方"></a>不熟练的地方</h2><h3 id="mapreduce"><a href="#mapreduce" class="headerlink" title="mapreduce"></a>mapreduce</h3><p>1.分区，小表和大表join（在hdfs上），两张大表的join，分组，读json文件，对一些脏数据的处理</p>
<p>msql里面表的读取，获取上下文的文件名，大表 join reduce端的操作</p>
<h3 id="hive"><a href="#hive" class="headerlink" title="hive"></a>hive</h3><p>1.读json文件，一些函数的使用，开窗函数，分组的顺序不同得到的结果也不同，要按照题目的要求来分组！</p>
<p>，创建hive json 表的row format，求方差和标准差的函数</p>
<h3 id="spark"><a href="#spark" class="headerlink" title="spark"></a>spark</h3><p>1.连接hive，连接mysql，用rdd进行清洗，读文件时的一些option,spark打包在集群中运行，hadoop shell命令，sqoop 的使用，读取hive，mysql里面的文件，用RDD读取有表头的文件怎么去掉表头？</p>
<p>读mysql要添加jar包</p>
<pre class=" language-scala"><code class="language-scala">spark<span class="token punctuation">.</span>sparkContext<span class="token punctuation">.</span>addJar<span class="token punctuation">(</span>args<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>12月21号上午花了接近四个小时把 12-07测试6 重新做了一遍，发现存在很多问题不过都已经一一解决。</p>
<p><strong>问题一：大表join在reduce端的一些操作。</strong></p>
<p>​    要把Bean对象设置为值，遍历值，把值放入到合适的新的Bean对象里面，而且还要定义一个ArrayList集合，两个Bean对象（有两个表），最后遍历ArrayList集合，把没有的数据添加到集合中，把遍历的集合传下去。</p>
<pre class=" language-java"><code class="language-java"> <span class="token comment" spellcheck="true">//注意userBean，还有context要放在循环中</span>

<span class="token keyword">for</span><span class="token punctuation">(</span>UserBean userBean<span class="token operator">:</span>totalLists<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
     userBean<span class="token punctuation">.</span><span class="token function">setBankA</span><span class="token punctuation">(</span>userBean2<span class="token punctuation">.</span><span class="token function">getBankA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     userBean<span class="token punctuation">.</span><span class="token function">setBankA</span><span class="token punctuation">(</span>userBean2<span class="token punctuation">.</span><span class="token function">getBankB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     userBean<span class="token punctuation">.</span><span class="token function">setBankA</span><span class="token punctuation">(</span>userBean2<span class="token punctuation">.</span><span class="token function">getBankC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     userBean<span class="token punctuation">.</span><span class="token function">setBankA</span><span class="token punctuation">(</span>userBean2<span class="token punctuation">.</span><span class="token function">getBankD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     userBean<span class="token punctuation">.</span><span class="token function">setBankA</span><span class="token punctuation">(</span>userBean2<span class="token punctuation">.</span><span class="token function">getBankE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     userBean<span class="token punctuation">.</span><span class="token function">setBankA</span><span class="token punctuation">(</span>userBean2<span class="token punctuation">.</span><span class="token function">getBankF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     userBean<span class="token punctuation">.</span><span class="token function">setBankA</span><span class="token punctuation">(</span>userBean2<span class="token punctuation">.</span><span class="token function">getBankG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     userBean<span class="token punctuation">.</span><span class="token function">setBankA</span><span class="token punctuation">(</span>userBean2<span class="token punctuation">.</span><span class="token function">getBankH</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>NullWritable<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>userBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>问题二：结果没有数据！！</strong></p>
<p>​    做标记的flag也要序列化！！</p>
<p>​    </p>
<p>问题三：数据有重复。</p>
<p>​    第一张表必须放在if条件后面。因为第一张表要放入集合中。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">芩芩</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://example.com/2021/10/17/MR-Hive-Spark%E9%94%99%E9%A2%98%E6%9C%AC/">http://example.com/2021/10/17/MR-Hive-Spark%E9%94%99%E9%A2%98%E6%9C%AC/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint policy. If reproduced, please indicate source
                    <a href="/about" target="_blank">芩芩</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">No tag</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;Current
            </div>
            <div class="card">
                <a href="/2021/10/17/MR-Hive-Spark%E9%94%99%E9%A2%98%E6%9C%AC/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/13.jpg" class="responsive-img" alt="MR-Hive-Spark错题本">
                        
                        <span class="card-title">MR-Hive-Spark错题本</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-10-17
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            芩芩
                            
                        </span>
                    </div>
                </div>

                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/10/16/Java%20Web%E6%A1%88%E4%BE%8B/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="Java Web小案例">
                        
                        <span class="card-title">Java Web小案例</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-10-16
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            芩芩
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">芩芩</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;Total visits:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;Total visitors:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/qinmeier/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1290353847@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1290353847" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1290353847" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="https://cdn.jsdelivr.net/gh/qinmeier/imager/img/20211016201850.jpg" class="tooltipped" target="_blank" data-tooltip="微信联系我: https://cdn.jsdelivr.net/gh/qinmeier/imager/img/20211016201850.jpg" data-position="top" data-delay="50">
        <i class="fab fa-weixin"></i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    
	
	<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
	<script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
	<script type="text/javascript" src="/js/fireworks.js"></script>

</body>

</html>
